
# idioms
# (âŠ£/+`)t=ğ•©       get indices of all items of type ğ•©

# t0: none, 
# tf: fragment
# tn: name
# to: open braces
# tc: close braces
# th: hash
# tl: slash
# ts: start tag  {#}
# te: end tag    {/}
# tt: tag        { }
# td: dot         .
t0â€¿tfâ€¿tnâ€¿toâ€¿tcâ€¿thâ€¿tlâ€¿tsâ€¿teâ€¿ttâ€¿tdâ†â†•11
Compileâ‡{
  # c: character values
  # p: parent vector
  # t: type vector
  # t: reference vector
  # n: name string values
  # f: fragment string values
  câ†ğ•©â‹„dâ†tâ†râ†nâ†@

  tâ†©âˆ¨Â´toâ€¿tcâ€¿thâ€¿tl(âŠ£Ã—câŠ¸=Â¨)"{}#/"                                                   # tokenize character types
  # TODO assert balanced bracets
  tâŒˆâŸœ(tnÃ—(+`toâŠ¸=-=âŸœtc))â†©â‹„{nâ†©âŠâŸœcÂ¨1â†“âŠ”âˆ§âŸœ(+`Â»âŠ¸<)âˆ˜ğ•© tâ‹„ tâ€¿c (Â¬â‰ âŸœ(Â«âŠ¸<)ğ•©)âŠ¸/Â¨â†©} tn=t # mark and compress names
  tsâ€¿te {zâ†(toâŠ¸=âˆ˜Â»âˆ§=âŸœğ•©)t â‹„ t(Â¬âˆ˜âŠ¢/âŠ£âˆ˜âŒˆâŸœ(ğ•¨âŠ¸Ã—Â«âˆ˜âŠ¢))âŸœzËœâ†© â‹„ cÂ¬âˆ˜zâŠ¸/â†©}Â¨thâ€¿tl              # mark and compress start, close
  tâŒˆâŸœ(ttÃ—t=to)â†© # set tag types
  râ†©â†•âˆ˜â‰ âŒ¾((t=tn)âŠ¸/) Â¯1Â¨t # set references
  # TODO assert balanced tags
  {zâ†(tnâŠ¸=âˆ§Â»âˆ˜=âŸœğ•©) t â‹„ r (z/r)âŒ¾((Â«z)âŠ¸/) â†© â‹„ câ€¿tâ€¿r (Â¬z)âŠ¸/Â¨â†©}Â¨tsâ€¿ttâ€¿te # compress names into start tag and end references
  câ€¿tâ€¿r (Â¬tc=t)âŠ¸/Â¨â†© #remove close brackets
  dâ†© +`(tsâŠ¸=-=âŸœte) t # depth vector
  {moâ‡câ€¿dâ€¿tâ€¿râ€¿n}
}

Renderâ‡{ 
    ğ•Š âŸ¨moâ‡moâŸ©:
    â€¢Show "compiled"
  #câ€¿dâ€¿tâ€¿râ€¿nâ†ğ•©.mo
  # match depths
  # expand repeats
  #â€¢SHow d
  #â€¢SHow t
  #â€¢SHow r
  #â€¢SHow c
;   ğ•Š ğ•© : 
    â€¢Show "not compiled!"
    ğ•Š Compile ğ•©
}
